<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Productos</h2>
    <a routerLink="/admin/productos/nuevo" class="btn btn-success">+ Nuevo</a>
  </div>

  <div class="input-group mb-4" style="max-width:400px">
    <input type="text" class="form-control" placeholder="Buscar..." [(ngModel)]="busqueda" (keyup.enter)="buscar()">
    <button class="btn btn-outline-secondary" (click)="buscar()">Buscar</button>
    <button class="btn btn-outline-danger" (click)="busqueda=''; cargar(0)">✕</button>
  </div>

  @if (cargando()) {
    <div class="text-center py-5"><div class="spinner-border text-success"></div></div>
  } @else if (!pagina()?.content?.length) {
    <div class="alert alert-info">No hay productos.</div>
  } @else {
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr><th>Nombre</th><th>Marca</th><th>Medida</th><th>Precio</th><th>Stock</th><th>Estado</th><th>Acciones</th></tr>
        </thead>
        <tbody>
          @for (p of pagina()!.content; track p.id) {
            <tr>
              <td>
                <strong>{{ p.nombre }}</strong><br>
                <small class="text-muted">{{ p.tipoVehiculo }}</small>
              </td>
              <td>{{ p.marca }}</td>
              <td>{{ p.medida ?? '—' }}</td>
              <td>S/ {{ p.precio | number:'1.2-2' }}</td>
              <td [class]="p.stock > 0 ? 'text-success fw-bold' : 'text-danger'">{{ p.stock }}</td>
              <td>
                <span class="badge" [class]="p.disponible ? 'bg-success' : 'bg-secondary'">
                  {{ p.disponible ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td>
                <div class="d-flex gap-1">
                  <a [routerLink]="['/admin/productos/editar', p.id]" class="btn btn-sm btn-outline-primary">Editar</a>
                  <button class="btn btn-sm btn-outline-danger" (click)="desactivar(p)"
                          [disabled]="eliminandoId() === p.id">
                    {{ eliminandoId() === p.id ? '...' : 'Desactivar' }}
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if ((pagina()?.totalPages ?? 0) > 1) {
      <nav class="mt-3"><ul class="pagination">
        <li class="page-item" [class.disabled]="pagina()?.first">
          <button class="page-link" (click)="cargar(paginaActual-1)">‹</button>
        </li>
        @for (p of paginas; track p) {
          <li class="page-item" [class.active]="p === paginaActual">
            <button class="page-link" (click)="cargar(p)">{{ p+1 }}</button>
          </li>
        }
        <li class="page-item" [class.disabled]="pagina()?.last">
          <button class="page-link" (click)="cargar(paginaActual+1)">›</button>
        </li>
      </ul></nav>
    }
  }
</div>
