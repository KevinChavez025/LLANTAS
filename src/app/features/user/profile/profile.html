<div class="profile-page">
  <div class="container">

    <div class="page-header">
      <h1 class="page-header__title">Mi perfil</h1>
      <nav class="page-header__breadcrumb">
        <a routerLink="/home">Inicio</a> / <span>Mi perfil</span>
      </nav>
    </div>

    <div class="profile-layout">

      <!-- Sidebar -->
      <aside class="user-sidebar">
        @if (usuario | async; as user) {
          <div class="user-sidebar__avatar">
            <div class="avatar-circle">
              {{ (user.nombre || user.email || 'U').charAt(0).toUpperCase() }}
            </div>
            <p class="user-sidebar__name">{{ user.nombre || user.email }}</p>
            <p class="user-sidebar__email">{{ user.email }}</p>
          </div>
        }
        <nav class="user-sidebar__nav">
          <a routerLink="/usuario/perfil" routerLinkActive="active" class="user-nav-item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
            </svg>
            Mi perfil
          </a>
          <a routerLink="/usuario/pedidos" routerLinkActive="active" class="user-nav-item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0"/>
            </svg>
            Mis pedidos
          </a>
          <a routerLink="/usuario/configuracion" routerLinkActive="active" class="user-nav-item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
            </svg>
            Configuración
          </a>
        </nav>
      </aside>

      <!-- Card principal -->
      <div class="profile-card">
        <div class="profile-card__header">
          <h2 class="profile-card__title">Datos personales</h2>
          @if (!editando()) {
            <button class="btn btn-outline" (click)="toggleEditar()">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Editar
            </button>
          }
        </div>

        <form [formGroup]="form" (ngSubmit)="guardar()" novalidate>
          <div class="form-grid">

            <div class="form-group form-group--full">
              <label>Nombre completo *</label>
              <input type="text" formControlName="nombreCompleto" [readonly]="!editando()"
                     placeholder="Ej: Juan Pérez Quispe"/>
              @if (f['nombreCompleto'].touched && f['nombreCompleto'].errors?.['required']) {
                <span class="form-error">Campo obligatorio</span>
              }
              @if (f['nombreCompleto'].touched && f['nombreCompleto'].errors?.['minlength']) {
                <span class="form-error">Mínimo 3 caracteres</span>
              }
            </div>

            <div class="form-group">
              <label>Teléfono</label>
              <input type="tel" formControlName="telefono" [readonly]="!editando()"
                     placeholder="Ej: 987654321"/>
              @if (f['telefono'].touched && f['telefono'].errors?.['pattern']) {
                <span class="form-error">Ingresa 9 dígitos</span>
              }
            </div>

            <div class="form-group">
              <label>Ciudad</label>
              <input type="text" formControlName="ciudad" [readonly]="!editando()"
                     placeholder="Ej: Lima"/>
            </div>

            <div class="form-group">
              <label>Distrito</label>
              <input type="text" formControlName="distrito" [readonly]="!editando()"
                     placeholder="Ej: Miraflores"/>
            </div>

            <div class="form-group form-group--full">
              <label>Dirección</label>
              <input type="text" formControlName="direccion" [readonly]="!editando()"
                     placeholder="Ej: Av. Javier Prado 1234"/>
            </div>

          </div>

          @if (editando()) {
            <div class="profile-card__actions">
              <button type="button" class="btn btn-outline" (click)="cancelar()">Cancelar</button>
              <button type="submit" class="btn btn-primary" [disabled]="guardando()">
                @if (guardando()) { Guardando... } @else { Guardar cambios }
              </button>
            </div>
          }
        </form>
      </div>

    </div>
  </div>
</div>